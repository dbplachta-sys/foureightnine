#default chains

iptables -P INPUT DROP
iptables -P OUTPUT ACCEPT
iptables -P FORWARD DROP

#logs

iptables -N ACCEPT_LOG
iptables -A ACCEPT_LOG -j LOG --log-level 6 --log-prefix 'accept_log:'
iptables -A ACCEPT_LOG -j ACCEPT

iptables -N DROP_LOG
iptables -A DROP_LOG -j LOG --log-level 6 --log-prefix 'drop_log:'
iptables -A DROP_LOG -j DROP

#web

iptables -A INPUT -p tcp -m state --state NEW,ESTABLISHED -m multiport --dports 22,80,443 -j ACCEPT_LOG

iptables -A OUTPUT -p tcp -m state --state ESTABLISHED -m multiport --sports 22,80,443 -j ACCEPT_LOG

#ntp

iptables -A INPUT -p udp -m state --state NEW,ESTABLISHED -m multiport --dport 123 -j ACCEPT_LOG

iptables -A OUTPUT -p udp -m state --state NEW,ESTABLISHED -m multiport --sport 123 -j ACCEPT_LOG

#east_west

iptables -A INPUT -s 10.11.83.0/24 -j ACCEPT_LOG
iptables -A OUTPUT -d 10.11.83.0/24 -j ACCEPT_LOG

#loopback

iptables -A OUTPUT -o lo -j ACCEPT
iptables -A INPUT -i lo -j ACCEPT

#default log --> drop

iptables -A INPUT -j DROP_LOG

iptables -A OUTPUT -j DROP_LOG
